---
title: "Gobox - HackTheBox"
layout: single
excerpt: "Esta es una mÃ¡quina de dificultad media, para su intrusiÃ³n me aproveche de un buffer vulnerable a 'SSTI' en un servidor con GO y logre enumerar depÃ³sitos con AWS y subir una 'webshell' en PHP al servidor web, para la escalada de privilegios conseguir encontrar un mÃ³dulo nginx de puerta trasera y encontrÃ© el parÃ¡metro que me hacÃ­a falta para el 'RCE' como el usuario 'ROOT'. "
header:
show_date: true
classes: wide
header:
  teaser: "https://user-images.githubusercontent.com/69093629/131720825-d761ac8e-337d-4d10-babd-1d4df7b69efd.jpg"
  teaser_home_page: true
  icon: "https://user-images.githubusercontent.com/69093629/125662338-fd8b3b19-3a48-4fb0-b07c-86c047265082.png"
categories:
  - HackTheBox
tags:
  - SSTI
  - GO
  - Nginx
  - aws
---

<p align="center">
<img src="https://user-images.githubusercontent.com/69093629/131720825-d761ac8e-337d-4d10-babd-1d4df7b69efd.jpg">
</p>

Comence con un escaneo de `Nmap` para detectar puertos abiertos.

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/home/kali/HTB/Gobux]
â””â”€# nmap -sS --min-rate=5000 -n -vvv --open -Pn 10.10.11.113 -oG allPorts 
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-01 10:33 EDT
Happy 24th Birthday to Nmap, may it live to be 124!
Initiating SYN Stealth Scan at 10:33
Scanning 10.10.11.113 [1000 ports]
Discovered open port 8080/tcp on 10.10.11.113
Discovered open port 22/tcp on 10.10.11.113
Discovered open port 80/tcp on 10.10.11.113
Completed SYN Stealth Scan at 10:33, 0.37s elapsed (1000 total ports)
Nmap scan report for 10.10.11.113
Host is up, received user-set (0.047s latency).
Scanned at 2021-09-01 10:33:20 EDT for 1s
Not shown: 994 closed ports, 3 filtered ports
Reason: 994 resets and 3 no-responses
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl 63
80/tcp   open  http       syn-ack ttl 63
8080/tcp open  http-proxy syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 0.48 seconds
           Raw packets sent: 1003 (44.132KB) | Rcvd: 997 (39.892KB)
```

Hice otro escaneo para saber la version de cada puerto abierto encontrado.

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/home/kali/HTB/Gobux]
â””â”€# nmap -sC -sV -p22,80,8080 10.10.11.113 -oN targeted                  
Starting Nmap 7.91 ( https://nmap.org ) at 2021-09-01 10:33 EDT
Nmap scan report for 10.10.11.113
Host is up (0.066s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 d8:f5:ef:d2:d3:f9:8d:ad:c6:cf:24:85:94:26:ef:7a (RSA)
|   256 46:3d:6b:cb:a8:19:eb:6a:d0:68:86:94:86:73:e1:72 (ECDSA)
|_  256 70:32:d7:e3:77:c1:4a:cf:47:2a:de:e5:08:7a:f8:7a (ED25519)
80/tcp   open  http    nginx
|_http-title: Hacking eSports | {{.Title}}
8080/tcp open  http    nginx
|_http-title: Hacking eSports | Home page
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.36 seconds
```

Habian dos servidores web, el que corria por el puerto `80` tenia lo siguiente.

![https://imgur.com/uDri3uL.png](https://imgur.com/uDri3uL.png)

Al parecer no habia nada interesante, en el segundo encontre algo distinto.

![https://imgur.com/XRw6QZA.png](https://imgur.com/XRw6QZA.png)

Habian dos "buffers" pero no tenia credenciales, intente ver si era vulnerable a `SQLi` pero no hubo suerte, me pedia que introduzca un correo.

![https://imgur.com/8o24U6Z.png](https://imgur.com/8o24U6Z.png)

Habia un boton llamado `Forgot Password`, le di y me llevo a otro "buffer".

![https://imgur.com/KZJetmj.png](https://imgur.com/KZJetmj.png)

Envie una una peticion por `GET` y gracias a las cabeceras identifique que corria `GO` en el servidor web, esto me llamo la atencion.

![https://imgur.com/jpnKkc5.png](https://imgur.com/jpnKkc5.png)

En este "buffer" tambien intente `SQLi` pero igual no hubo suerte.

![https://imgur.com/EwhF8wK.png](https://imgur.com/EwhF8wK.png)

Me invente un correo y lo introduje, me puso que se envio.

![https://imgur.com/dylVlfD.png](https://imgur.com/dylVlfD.png)

Quise interceptar la peticion para ver como corre todo por detras, para ello use `burp`.

![https://imgur.com/6VreJyc.png](https://imgur.com/6VreJyc.png)

Sabiendo que corre `GO` en el servidor me acorde de `nmap`, vi que me reportaba un titulo de la pagina sospechoso de una vulnerabilidad.

![https://imgur.com/ApK3ETK.png](https://imgur.com/ApK3ETK.png)

Busque si podia ser vulnerable a `SSTI` un servidor con `GO` y encontre lo siguiente.

![https://imgur.com/umgsZbr.png](https://imgur.com/umgsZbr.png)

Se podia identificar y confirmar si era vulnerable con `{{ . }}`, inmediatamente lo probe en el campo de `email` y me reporto lo siguiente.

![https://imgur.com/FgrhFqM.png](https://imgur.com/FgrhFqM.png)

Al parecer si es vulnerable, me reporto en texto plano unas credenciales que al parecer podian ser de los "buffers" del inicio, las introduje y me redirigio a una pagina con un codigo.

![https://imgur.com/c1UEcmF.png](https://imgur.com/c1UEcmF.png)

Lo que mas me llamo la atencion es la funcion `DebugCmd`.

![https://imgur.com/vGoAv9m.png](https://imgur.com/vGoAv9m.png)

Al parecer me permitia ejecutar codigo en el sisteam pasandole los argumentos, lo probe en `burp`.
 
![https://imgur.com/cDNEAxv.png](https://imgur.com/cDNEAxv.png)

Y funciono, intente ver la `IP` que tenia pero no existia el comando `ifconfig`, tambien quise verficar si la maquina podia tener conectivadad conmigo pero tampoco existia el comando `ping` ni el comando `wget`.

![https://imgur.com/ZSuCUtG.png](https://imgur.com/ZSuCUtG.png)

Esto me hizo pensar que estaba en un contenedor, mire el archivo `/proc/net/fib_trie` y efectivamente estaba en un contenedor.

![https://imgur.com/w3i498N.png](https://imgur.com/w3i498N.png)

Tras un tiempo desesperado encontre que tenia el comando `aws` habilitado, eso me llamo la atencion, esto me permitiria enumerar y copiar depositos, realmente se pueden hacer mas cosas, pero no me interesa.

![https://imgur.com/7wNaj68.png](https://imgur.com/7wNaj68.png)

Probe a enumerar los depositos y encontrÃ© uno llamado `website`.

![https://imgur.com/l7QaVBG.png](https://imgur.com/l7QaVBG.png)

Accedi a el y encontre algo que me llamo mucho la atencion, los archivos que habian al parecer se estaban comunicando con el servidor web que corre por el puerto `80`, entonces pense que si conseguia incluir algun archivo podia tener acceso a el desde el servidor web, antes de eso probe a enumerar las credenciales de `aws` que se almacenaban en `~/aws/credentials`.

![https://imgur.com/UO0QRes.png](https://imgur.com/UO0QRes.png)

Y pude enumerarlas.

![https://imgur.com/DqqNclW.png](https://imgur.com/DqqNclW.png)

Me servian para tener conectividad desde mi maquina, pero eso no me interesaba, asi que probe a incluir una `webshell` en PHP al servidor web, tuve que codificarla en `urlencode` sino no me dejaba, la exporte a `/tmp` con el nombre `reversess.php`.

![https://imgur.com/LHsv5I7.png](https://imgur.com/LHsv5I7.png)

Y la consegui incluirla en el deposito con el parametro `cp` de `aws`.

![https://imgur.com/fDV4XnZ.png](https://imgur.com/fDV4XnZ.png)

Fui al servidor web y gane ejecucion de codigo arbitrario.

![https://imgur.com/cTcPnbb.png](https://imgur.com/cTcPnbb.png)

Para entablarme una `reverse shell` cree un archivo `txt` con el codigo que me iva a permitir ganar acceso al sistema y abri un servidor web por el puerto `8000`.

![https://imgur.com/Y0G7wKq.png](https://imgur.com/Y0G7wKq.png)

Le hice un `curl` desde la `webshell`.

![https://imgur.com/VjK4TCF.png](https://imgur.com/VjK4TCF.png)

Y ahora tan solo pipee el codigo con `bash` y gane acceso como el usuario `www-data`.

![https://imgur.com/ikL9Wqm.png](https://imgur.com/ikL9Wqm.png)

Hice un tratamiento de la `TTY` y ya pude visualizar la "flag" del usuario.

![j7W85u2](https://user-images.githubusercontent.com/69093629/131735155-a30e7a1e-9d0c-4d21-a046-b5194b45301f.jpg)

Ahora solo faltaba la escalada de privilegios, enumere los privilegios `SUID` pero no encontre nada interesante.

![https://imgur.com/S04sYGq.png](https://imgur.com/S04sYGq.png)

Enumerando un poco mas encontre un servidor web en escucha por el puerto `8000` pero lo que mas me llamo la atencion es que solo es accesible desde `localhost`, decidi investigar en los modulos de `nginx` y encontre uno que me llamo la atencion mucho, llamado `50-backdoor.conf`, le hice un `cat` y me reporto una ruta en texto claro, tras investigarlo en internet encontre que habia una puertra trasera.

![Captura de pantalla (16)](https://user-images.githubusercontent.com/69093629/131731107-7086603b-e2bb-4812-b671-97b43bccf1bd.png)

Pero para activarla necesitaba el parametro que se configuro, para encontar el parametro necesitaba una copia, para ello filtre con `find` el nombre del archivo y lo encontre.

![https://imgur.com/zDLUO81.png](https://imgur.com/zDLUO81.png)

Le hice un string y filtre por `run` para encontrarlo de una manera mas rapida y lo conseguir encontrar.

![https://imgur.com/iOKieyF.png](https://imgur.com/iOKieyF.png)

Ahora solo faltaba enviar una peticion al servidor en `localhost` haciendo uso del parametro encontrado y ganaria ejecucion de comando como el usuario `root`.

![https://imgur.com/Yx7dg2D.png](https://imgur.com/Yx7dg2D.png)

Y ya pude visualizar la "flag" de `root`.

![aZxblDX](https://user-images.githubusercontent.com/69093629/131735375-90143da8-ab12-4b4d-bfb9-5740f5604bb3.jpg)






