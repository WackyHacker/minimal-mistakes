---
title: "ArcheType - HackTheBox"
layout: single
excerpt: "Esta es una mÃ¡quina de dificultad difÃ­cil, para su intrusiÃ³n me aproveche de una versiÃ³n vulnerable de 'cacti' y gane acceso a la mÃ¡quina explotando 'SQLi' de manera automatizada y ganando acceso desde un shell inverso de 'mkfifo', para la escalada encontrÃ© una 'capability' de Docker, un mÃ³dulo de kernel llamado 'SYS_MODULE' vulnerable."
header:
show_date: true
classes: wide
header:
  teaser: "https://user-images.githubusercontent.com/69093629/137588422-2cdee7fe-c2a8-4b87-87f7-f8fa87d4af6a.jpg"
  teaser_home_page: true
  icon: "https://user-images.githubusercontent.com/69093629/125662338-fd8b3b19-3a48-4fb0-b07c-86c047265082.png"
categories:
  - HackTheBox
tags:
  - smbclient
  - extractports
  - crackmapexec
  - Starting Point
---

<p align="center">
<img src="https://user-images.githubusercontent.com/69093629/137588497-e7175744-003c-4d58-b61c-86b13a057596.jpg">
</p>

Comence con escaneo de `Nmap` para detectar puertos abiertos.

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/home/â€¦/HTB/Monitors/machine/nmap]
â””â”€# nmap -sS --min-rate=5000 -vvv -n -Pn --open 10.10.10.238 -o targeted.txt
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower.
Warning: The -o option is deprecated. Please use -oN
Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-10 11:33 EDT
Initiating SYN Stealth Scan at 11:33
Scanning 10.10.10.238 [1000 ports]
Discovered open port 80/tcp on 10.10.10.238
Discovered open port 22/tcp on 10.10.10.238
Completed SYN Stealth Scan at 11:33, 0.24s elapsed (1000 total ports)
Nmap scan report for 10.10.10.238
Host is up, received user-set (0.045s latency).
Scanned at 2021-10-10 11:33:47 EDT for 0s
Not shown: 998 closed ports
Reason: 998 resets
PORT   STATE SERVICE REASON
22/tcp open  ssh 	syn-ack ttl 63
80/tcp open  http	syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 0.34 seconds
       	Raw packets sent: 1000 (44.000KB) | Rcvd: 1000 (40.008KB)
```

Hice otro escaneo con `Nmap` para detectar la version de cada puerto y servicio abierto.

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/home/â€¦/HTB/Monitors/machine/nmap]
â””â”€# nmap -sCV -p22,80 10.10.10.238 -o webScan.txt                                                                                       	130 â¨¯
Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-10 11:35 EDT
Nmap scan report for 10.10.10.238
Host is up (0.045s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh 	OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ba:cc:cd:81:fc:91:55:f3:f6:a9:1f:4e:e8:be:e5:2e (RSA)
|   256 69:43:37:6a:18:09:f5:e7:7a:67:b8:18:11:ea:d7:65 (ECDSA)
|_  256 5d:5e:3f:67:ef:7d:76:23:15:11:4b:53:f8:41:3a:94 (ED25519)
80/tcp open  http	Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn't have a title (text/html; charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.95 seconds
```
Tan solo tenia dos puertos abiertos el servidor, comence enumerando el servidor web, esto es lo que tenia.

![https://imgur.com/gleTbyw.png](https://imgur.com/gleTbyw.png)

Parece que se estaba aplicando `virtual hosting`, almacenar distintos dominios en una misma IP, para ello abri el `/etc/hosts` e inclui el dominio `monitors.htb`.

![https://imgur.com/uipe3ri.png](https://imgur.com/uipe3ri.png)

Ahora si me reporto lo que tenia realmente.

![https://imgur.com/8wWXphm.png](https://imgur.com/8wWXphm.png)

Le hice un `whatweb` para ver si corria algun `CMS`.

```bash
â”Œâ”€â”€(rootðŸ’€kali)-[/home/â€¦/HTB/Monitors/machine/nmap]
â””â”€# whatweb http://monitors.htb/                                                   	 
http://monitors.htb/ [200 OK] Apache[2.4.29], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.10.238], JQuery, MetaGenerator[WordPress 5.5.1], Script[text/javascript], Title[Welcome to Monitor &#8211; Taking hardware monitoring seriously], UncommonHeaders[link], WordPress[5.5.1]
```

Al parecer era un servidor web con `Wordpress` instalado, enumerando un poco la web encontre que tenia `directory listing` de los plugins, encontrÃ© uno llamado `wp-with-spritz`.

![https://imgur.com/AgMIHZ0.png](https://imgur.com/AgMIHZ0.png)

Busque en internet si habia algun exploit relacionado con el plugin.

![https://imgur.com/RBKDaS5.png](https://imgur.com/RBKDaS5.png)

EncontrÃ© unos cuantos, me decante por el que estaba publicado en [exploit.db](https://exploitdb.com/).

![https://imgur.com/GCEmKDt.png](https://imgur.com/GCEmKDt.png)

Viendolo vi que el servidor web era vulnerable a `Local File Inclusion`, es decir que podia ver archivos locales de la maquina, probe a enumerar el `/etc/hosts` para confirmar la vulnerablidad.

![https://imgur.com/5EuTLGD.png](https://imgur.com/5EuTLGD.png)

Efectivamente, podia enumerar archivos, en este caso probe a enumerar el archivo de configuracion de `WordPress` con `curl`, estos suelen tener credenciales harcodeadas, tras unos cuantos intentos tratando de dar con la ruta lo encontrÃ©.

![https://imgur.com/c6a0jRF.png](https://imgur.com/c6a0jRF.png)

Algo que me llamo la atencion es que no interpretaba el codigo `PHP` por lo que no tuve que hacer uso de un "wrapper".

![https://imgur.com/2RGpKpo.png](https://imgur.com/2RGpKpo.png)

Ahora bien, probe estas credenciales en el panel de inicio de sesion de `WordPress` pero no hubo suerte.

![https://imgur.com/A51K99w.png](https://imgur.com/A51K99w.png)

Aprovechando la vulnerablidad `LFI` probe a enumerar el archivo `000-default.conf` este archivo podia tener informacion sobre dominios o subdominios que podrian estar operativos en el sistema.

![https://imgur.com/c6a0jRF.png](https://imgur.com/c6a0jRF.png)

Y si, encontrÃ© `cacti.monitors.htb`, lo inclui en el `/etc/hosts` y accedi a la web, me reporto un panel de inicio de sesion.

![https://imgur.com/zyVFcWE.png](https://imgur.com/zyVFcWE.png)

Inmediatamente probe las credenciales que habia conseguido en la enumeracion del archivo de configuracion de `WordPress`.

![https://imgur.com/PkEkPML.png](https://imgur.com/PkEkPML.png)

Y me autentico.

![https://imgur.com/CDcopSP.png](https://imgur.com/CDcopSP.png)

Ya que sabia la version decidi buscar exploit de este panel y encontrÃ© uno que tenia que estar autenticado.

![https://imgur.com/YyyEGtR.png](https://imgur.com/YyyEGtR.png)

Examinandolo un poco vi que se aprovechaba de una consulta maliciosa `SQL` para explotar la vulnerabidad, para ganar acceso hace uso de un Shell inverso con `mkfifo`.

![https://imgur.com/wiX1Rvr.png](https://imgur.com/wiX1Rvr.png)

Ejecute el "exploit" haciendo uso de las credenciales de inicio de sesion en el panel, mi IP, el puerto y gane acceso a la maquina.

![https://imgur.com/DsIengg.png](https://imgur.com/DsIengg.png)

Hice un tratamiento de la `TTY` y enumere usuarios, encontrÃ© `markus` operativo en el sistema.

![https://imgur.com/hDZXMFI.png](https://imgur.com/hDZXMFI.png)

Ya que no tenia capacidad de ver la "flag" del usuario enumere un poco la maquina y encontre un archivo que me llamo la atencion llamado `cacti-backup.service`, al verlo encontre una ruta que estaba en el directorio de `markus`, yendo a este directorio vi que habia una carpeta llamada `.backup` que estaba oculta.

![https://imgur.com/h65jw3V.png](https://imgur.com/h65jw3V.png)

Mirando el archivo llamado `backup.sh` encontre credenciales en texto claro.

![https://imgur.com/K9IPqJs.png](https://imgur.com/K9IPqJs.png)

Probe a usarlas para pivotear al usuario `markus` y funciono.

![https://imgur.com/ZZUd7un.png](https://imgur.com/ZZUd7un.png)

Ahora ya pude visualizar la "flag" del usuario.

![VYcjmdD](https://user-images.githubusercontent.com/69093629/137590879-5e9fa574-952e-485c-b29b-0b794e4740c8.jpg)

En el directorio principal de `markus` tambien habia un archivo llamado `note.txt`, al verlo encontre encontre lo siguiente.

![https://imgur.com/EupX3rZ.png](https://imgur.com/EupX3rZ.png)

Ponia que deshabilito `phpinfo` en `php.ini` pero no actualizo una imagen de Docker, esto me llamo la atencion, pense en que mas adelante podria aprovechar esta informacion para algo, de momento decidi seguir investigando un poco mas la maquina, enumerando permisos `SUID` no encontrÃ© nada interesante.

![https://imgur.com/5rzyhO2.png](https://imgur.com/5rzyhO2.png)

La maquina tambien tenia conectividad por `SSH` con las credenciales encontradas anteriormente, me quede con esta Shell.

![https://imgur.com/9PPj1ah.png](https://imgur.com/9PPj1ah.png)

Enumerando un poco mas encontre un servidor web en la maquina corriendo por el puerto `8443`.

![GJcJ7u7](https://user-images.githubusercontent.com/69093629/137591307-06bb32b2-63a5-481e-a255-c270fa681f66.png)

Esto me llamo mucho la atencion por lo que decidi ver lo que tenia, para ello tuve que hacer un `port forwarding`, basicamente hice que el servidor web de la maquina actue como un servi












